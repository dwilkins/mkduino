#! /usr/bin/env ruby
#
# mkduino.rb
#   Ruby script for generating a GNU Automake (ish)
#   environment for Arduino development
#
# (C) Copyright 2013
# David H. Wilkins  <dwilkins@conecuh.com>
#
# This program is free software; you can redistribute it and/or
# modify it under the terms of the GNU General Public License as
# published by the Free Software Foundation; either version 2 of
# the License, or (at your option) any later version.
#
# This program is distributed in the hope that it will be useful,
# but WITHOUT ANY WARRANTY; without even the implied warranty of
# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.	 See the
# GNU General Public License for more details.
#
# You should have received a copy of the GNU General Public License
# along with this program; if not, write to the Free Software
# Foundation, Inc., 59 Temple Place, Suite 330, Boston,
# MA 02111-1307 USA
#

require "mkduino"

ma = Mkduino::MakefileAm.new
ma.find_arduino_libraries '/usr/share/arduino/libraries'
ma.find_arduino_libraries '/usr/share/arduino/hardware/arduino/cores'
ma.find_source_files
ca = Mkduino::ConfigureAc.new ma
as = Mkduino::AutogenSh.new
puts ma.to_yaml

##
# Output the Makefile.am file withe the needed variable replacements
##
ma.write_makefile_am
##
# Output the configure.ac - requires a few things from Makefile.am
##
ca.write_configure_ac
##
# Finally write the autogen.sh - no replacements there
##
as.write_autogen_sh

#
# A few shell commands required to make it all tidy
#
`chmod +x autogen.sh`
`mkdir m4` unless Dir.exist?('m4')
`mkdir config` unless Dir.exist?('config')
`touch config/config.h`
`touch NEWS`
`touch README`
`touch AUTHORS`
`touch ChangeLog`

puts "*******************************"
puts "** now run ./autogen.sh      **"
puts "*******************************"
